<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <!-- <link rel="icon" href="<%= BASE_URL %>favicon.ico" /> -->
    <title>月亮</title>
  </head>
  <style>
    html {
      /* scale: 0.5; */
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: rgb(0, 0, 0);
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .starBox {
      position: absolute;
      top: 0;
      left: 0;
      transition: 0.5s all ease-in-out;
      will-change: box-shadow, transform;
    }

    .star,
    .star::before {
      border-radius: 100% 100% 100% 100%;
      border-width: 6px 0px 6px 0px;
      border-style: solid;
      /* box-shadow: 0 0 2px 0px #fff; */
      will-change: box-shadow, background-color;
      transition: .3s all ease-in-out;
    }

    .star {
      position: relative;
      transform: scale(0.6);
      background-color: #fff;
      border-color: #fff;
      width: 2px;
      height: 2px;
    }

    .star::before {
      content: "";
      width: 2px;
      height: 2px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(90deg);
      animation: inherit;
      background-color: inherit;
      border-color: inherit;
    }

    @keyframes shining {
      0%,
      100% {
        box-shadow: 0 0 3px 1px #fff;
      }
      50% {
        box-shadow: 0 0 6px 1px #fff;
      }
    }
    @keyframes moonShining {
      0%,
      100% {
        box-shadow: 0 0 20px 14px #fff;
      }
      50% {
        box-shadow: 0 0 20px 20px #fff;
      }
    }

    .moonBox {
      width: 100px;
      height: 100px;
      position: absolute;
      display: flex;
      justify-content: center;
      align-items: center;
      top: 0;
      left: 0;
      /* transform: translate(100px, 100px); */
      border: 1px solid #fff;
      border-radius: 100%;
      background-color: #000;
      transition: 0s all;
      /* box-shadow: 0 0 20px 20px #fff; */
      z-index: 10;
      animation: moonShining 2s ease-in-out infinite;
      cursor: none;
      will-change: box-shadow, transform;
    }
    .moonBox::before {
      content: "";
      width: 10px;
      height: 10px;
      border-radius: 100%;
      /* background-color: #fff; */
      box-shadow: 0px 0px 10px 10px #fff;
    }
  </style>
  <body>
    <div class="starBox" style="display: none">
      <div class="star"></div>
    </div>
    <div class="moonBox"></div>
  </body>
  <script>
    const StarNum = 100;
    const star = document.getElementsByClassName("starBox")[0];
    const Moon = document.getElementsByClassName("moonBox")[0];
    const MoonD = 100;
    const MoonR = MoonD / 2;
    const InitMoonX = Moon.offsetLeft + MoonR;
    const InitMoonY = Moon.offsetTop + MoonR;
    const MoonShadow = 20;
    const StarScale = 0.6;
    const StarWidth = 10;
    const StarHeight = 10;
    const otherXDist = StarWidth + MoonShadow;
    const otherYDist = StarHeight + MoonShadow;
    const starArr = [];
    for (let i = 0; i < StarNum; i++) {
      const newStar = star.cloneNode(true);
      const randomShining = `shining ${
        0.5 + Math.random() * 0.7
      }s linear infinite`;
      let left = Math.random() * document.body.offsetWidth;
      let top = Math.random() * document.body.offsetHeight;
      const moonDist = Math.abs(
        Math.sqrt(Math.pow(InitMoonX - left, 2) + Math.pow(InitMoonY - top, 2))
      );
      if (moonDist < MoonR) {
        const ratio = MoonR / moonDist;
        const leftDist = left - InitMoonX;
        const topDist = top - InitMoonY;
        left = InitMoonX + leftDist * ratio;
        top = InitMoonY + topDist * ratio;
      }
      newStar.style.transform = `translate(${
        left + (left < InitMoonX ? -1 : 1) * otherXDist
      }px, ${top + (top < InitMoonY ? -1 : 1) * otherYDist}px)`;
      newStar.style.display = "block";
      const starCore = newStar.getElementsByClassName("star")[0];
      starCore.style.animation = randomShining;
      starArr.push(newStar);
      document.body.appendChild(newStar);
    }
    star.remove();

    const moveStar = (star, MX, MY) => {
      let MoonX = MX;
      let MoonY = MY;
      if (!MX || !MY) {
        const moon = document.getElementsByClassName("moonBox")[0];
        const moonTransform = window
          .getComputedStyle(moon)
          .transform.replace("matrix(", "")
          .replace(")", "")
          .split(",");
        MoonX = parseInt(moonTransform.at(-2).trim());
        MoonY = parseInt(moonTransform.at(-1).trim());
      }
      const randomRun = Math.random() * 30;
      const totalOtherXDist = otherXDist + randomRun;
      const totalOtherYDist = otherYDist + randomRun;
      // const star = starArr[i];
      const starTransform = window
        .getComputedStyle(star)
        .transform.replace("matrix(", "")
        .replace(")", "")
        .split(",");
      let left = parseInt(starTransform.at(-2).trim());
      let top = parseInt(starTransform.at(-1).trim());
      const moonDist = Math.abs(
        Math.sqrt(Math.pow(MoonX - left, 2) + Math.pow(MoonY - top, 2))
      );
      if (moonDist < MoonR) {
        const ratio = MoonR / moonDist;
        const leftDist = left - MoonX;
        const topDist = top - MoonY;
        left = MoonX + leftDist * ratio;
        top = MoonY + topDist * ratio;
        let moveX = left;
        let moveY = top;
        if (moveX < 0) moveX = moveX + MoonD;
        if (moveX > document.body.offsetWidth) moveX = moveX - MoonD;
        if (moveY < 0) moveY = MoonY + MoonD;
        if (moveY > document.body.offsetHeight) moveY = MoonY - MoonD;
        const starCore = star.getElementsByClassName("star")[0];
        // starCore.style.borderColor = "#f00";
        starCore.style.backgroundColor = "#f00";
        starCore.style.transform = "scale(1.2)";
        star.style.transform = `translate(${
          moveX + (left < MoonX ? -1 : 1) * totalOtherXDist
        }px, ${moveY + (top < MoonY ? -1 : 1) * totalOtherYDist}px)`;
        setTimeout(() => {
          // const starCore = star.getElementsByClassName("star")[0];
          // starCore.style.borderColor = "#fff";
          starCore.style.backgroundColor = "#fff";
        starCore.style.transform = "scale(0.6)";
        }, 500);
      }
    };

    const reboundStar = (MX, MY) => {
      let MoonX = MX;
      let MoonY = MY;
      if (!MX || !MY) {
        const moon = document.getElementsByClassName("moonBox")[0];
        const moonTransform = window
          .getComputedStyle(moon)
          .transform.replace("matrix(", "")
          .replace(")", "")
          .split(",");
        MoonX = parseInt(moonTransform.at(-2).trim());
        MoonY = parseInt(moonTransform.at(-1).trim());
      }
      for (let i = 0; i < starArr.length; i++)
        moveStar(starArr[i], MoonX, MoonY);
    };
    let movingTimeout = null;
    const movingMoon = (e) => {
      const MoonX = e.x;
      const MoonY = e.y;
      const moon = document.getElementsByClassName("moonBox")[0];
      moon.style.transform = `translate(${MoonX - MoonD / 2}px, ${
        MoonY - MoonD / 2
      }px)`;
      reboundStar(MoonX, MoonY);
    };
    document.body.addEventListener("mousemove", movingMoon);

    // setInterval(() => {
    //   starArr.forEach((star) => {
    //     const starTransform = window
    //       .getComputedStyle(star)
    //       .transform.replace("matrix(", "")
    //       .replace(")", "")
    //       .split(",");
    //     const left = parseInt(starTransform.at(-2).trim());
    //     const top = parseInt(starTransform.at(-1).trim());
    //     let moveX = left + Math.random() * 60 - 30;
    //     let moveY = top + Math.random() * 60 - 30;
    //     if (left < 0) moveX = 0;
    //     if (left > document.body.offsetWidth) document.body.offsetWidth;
    //     if (top < 0) moveY = 0;
    //     if (top > document.body.offsetHeight)
    //       moveY = document.body.offsetHeight;
    //     star.style.transform = `translate(${moveX}px, ${moveY}px)`;
    //     moveStar(star)
    //   });
    // }, 200);
  </script>
</html>
