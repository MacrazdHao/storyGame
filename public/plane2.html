<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <!-- <link rel="icon" href="<%= BASE_URL %>favicon.ico" /> -->
    <title>飞机</title>
  </head>
  <style>
    /* transform-style: preserve-3d; 及 will-change能够提长动画性能 */
    html {
      /* scale: 0.5; */
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }

    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: rgb(0, 0, 0);
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    * {
      margin: 0;
      padding: 0;
    }

    .plane {
      position: absolute;
      top: 0;
      left: 0;
      transition-property: all;
      transition-timing-function: ease-out;
      will-change: transform;
    }

    .badPlane::before {
      content: "";
      display: block;
      position: absolute;
      top: 0;
      left: 0;
      transform: translate(calc(-50% + 6px), calc(-50% + 38px));
      width: 12px;
      height: 12px;
      border-radius: 100%;
      background-color: #ff0;
      z-index: 10;
    }

    .badPlane-cabin {
      position: relative;
      transform: scale(0.6);
      background-color: #fff;
      border-color: #fff;
      width: 12px;
      height: 60px;
      border-radius: 100% 100% 100% 100%;
      border-width: 3.6px 0px 3.6px 0px;
      border-style: solid;
      /* box-shadow: 0 0 2px 0px #fff; */
      /* will-change: background-color; */
      transition: 0.3s all ease-in-out;
      z-index: 5;
    }

    .badPlane-wing {
      border-radius: 100% 100% 100% 100%;
      z-index: 6;
    }

    .badPlane-wing--front {
      content: "";
      width: 72px;
      height: 12px;
      position: absolute;
      top: 0;
      left: 0;
      border-color: #00f;
      transform: translate(calc(-50% + 6px), 32px);
      background-color: #00f;
    }

    .badPlane-wing--before {
      content: "";
      width: 24px;
      height: 6px;
      position: absolute;
      top: 0;
      left: 0;
      transform: translate(calc(-50% + 6px), 16.4px);
      animation: inherit;
      background-color: inherit;
      border-color: inherit;
      background-color: #00f;
    }

    .badPlane-gun {
      display: block;
      width: 6px;
      height: 12px;
      background-color: rgb(100, 100, 100);
      position: absolute;
      z-index: 4;
    }

    .badPlane[data-type="1"] {
      transform: translate(-15px, -32px);
    }

    .badPlane[data-type="2"] {
      transform: translate(21px, -32px);
    }

    .bullet {
      position: absolute;
      top: 0;
      left: 0;
      width: 10px;
      height: 10px;
      border-radius: 100%;
      will-change: box-shadow, background-color, transform;
    }
    .badBullet {
      width: 6px;
      height: 6px;
    }
    .bullet--type1 {
      background-color: rgb(255, 81, 0);
      box-shadow: 0 2px 6px 0px rgb(255 130 71);
      transition: 1s all ease-in;
    }
  </style>
  <body>
    <div class="bullet badBullet badBullet--type1" style="display: none"></div>
    <div class="plane badPlane badPlane--type1" style="display: none">
      <div class="badPlane-cabin"></div>
      <div class="badPlane-wing badPlane-wing--front"></div>
      <div class="badPlane-wing badPlane-wing--before"></div>
      <!-- 机枪标签用li，方便CSS用nth-of-type筛选 -->
      <div class="badPlane-gun" data-type="1"></div>
      <div class="badPlane-gun" data-type="2"></div>
    </div>
  </body>
  <script>
    let WindowWidth = document.body.offsetWidth; // 屏幕宽度
    let WindowHeight = document.body.offsetHeight; // 屏幕长度
    window.addEventListener("resize", () => {
      WindowWidth = document.body.offsetWidth; // 屏幕宽度
      WindowHeight = document.body.offsetHeight; // 屏幕长度
    });

    let MaxBadPlaneNum = 5;

    const BadBulletTypesInfo = [
      {
        bulletType: 0,
        bulletProto: document.getElementsByClassName(`bullet--type1`)[0],
        bulletClipLimit: 20,
        reloadTime: 1000,
        bulletHotNum: 50,
        bulletD: 10,
        tempBulletClipNum: MAXNUM, // 可用弹夹数，用完即弃
        frequency: 1000
      },
    ];

    // 获取子弹类型对应的发射频率(ms/unit)
    const getBulletFreqency = (type = 1, isMine = true) => {
      switch (type) {
        case 1:
          return isMine ? 100 : 1000;
        default:
          return isMine ? 100 : 1000;
      }
    };
    const BadPlanes = [];
    // 获取子弹对象
    const getBulletObject = ({
      type = 1,
      originPos = { x, y },
      isMine = true,
    }) => {
      const bullet = document
        .getElementsByClassName(
          `${isMine ? "bullet" : "badBullet"}--type${type}`
        )[0]
        .cloneNode(true);
      let target = { x: 0, y: 0 };
      switch (type) {
        case 1:
          target = {
            x: originPos.x,
            y: isMine ? -(WindowHeight + 20) : originPos.y + WindowHeight + 20,
          };
          break;
        default:
          target = {
            x: originPos.x,
            y: isMine ? -(WindowHeight + 20) : originPos.y + WindowHeight + 20,
          };
          break;
      }
      bullet.style.display = "block";
      return { bullet, target };
    };
    const badPlaneFlyOut = (badPlane, distPos = { x: 0, y: 0 }) => {
      badPlane.style.transform = `translate(${curPlaneX}px, ${curPlaneY}px)`;
      setTimeout(() => {
        badPlane.remove();
      }, flyDuration);
    };
    const badFire = (badPlane, movePos = []) => {};
    const move = (badPlane, flyDuration, movePos = [], fireInfo=[]) => {
      // movePosItem - {x, y, stayDuration}  xy不超过可视界面
      // fireInfoItem - {bulletNum, bulletType}
      // n*(stayDuration+flyDuration)
    };
    const createBadPlanes = ({
      type = 1,
      originSide = "front",
      originPos = { x: 0, y: 0 },
      movePos = [],
      distSide = "back",
      distPos = { x: 0, y: 0 },
      flyDuration = 1000,
      fireInfo = []
    }) => {
      // front, left, right, custom(originPos)
      const badPlane = document
        .getElementsByClassName(`badPlane--type${type}`)[0]
        .cloneNode(true);
      badPlane.style.display = "block";
      badPlane.style.transitionDuration = `${flyDuration / 1000}s`;
      const oPos = originPos;
      switch (originSide) {
        case "front":
          // x = oP.x || randomX
          // y = -50
          break;
        case "left":
          // x = -50
          // y = oP.y || randomY
          break;
        case "right":
          // x = windowWidth + badPlaneWidth + 50
          // y = oP.y || randomY
          break;
        case "custom":
          break;
        default:
          break;
      }
      document.body.append(badPlane);
      // 计算动线终点
      const dPos = { ...distPos, stayDuration: 0 };
      switch (distSide) {
        case "back":
          // y = windowHeight + badPlaneWidth + 50
          break;
        case "left":
          // x = -50
          // y = oP.y || randomY
          break;
        case "right":
          // x = windowWidth + badPlaneWidth + 50
          // y = oP.y || randomY
          break;
        case "custom":
          break;
        default:
          break;
      }
      movePos(badPlane, flyDuration, [...movePos, dPos], fireInfo);
    };
  </script>
</html>
